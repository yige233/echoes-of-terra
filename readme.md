# 《泰拉寻旅》离线版

《明日方舟》五周年网页活动[《泰拉巡旅》](https://ak.hypergryph.com/activity/echoes-of-terra/)的一个备份。

介绍视频：[《泰拉巡旅》，但是离线版](https://www.bilibili.com/video/BV1TZ421x7sD)

- 通过 ServiceWorker 接管页面内的所有请求，并根据请求返回伪造的响应。
- 将所有资源压缩为.zip 文件，并通过[jsZIP](https://github.com/Stuk/jszip)解压文件，避免了大量请求。
- 借助 CacheStorage，将解压后的资源显式缓存到浏览器中，同时供 ServiceWorker 使用。
- 借助 ServiceWorker 修改响应的能力，动态修改页面脚本和 html，而无需显式修改原网页的代码，同时达到增强原网页功能的目的。

## 特点

- 可以完全离线运行，基本上无需联网。
- 添加了一些原网页没有的功能：
  - 修复多索雷斯场景，搜索干员按钮列表里没有龙舌兰的问题
  - 为预览模式按钮增加了同时进入全屏的功能
  - 点击场景中的小人，可以播放对应干员的语音（该功能需要联网，以便从 prts.wiki 获取语音文件。全语音太多了，缓存会很消耗磁盘空间）
  - 可自定义 BGM，以及调整 BGM 音量

## 使用方法

以 demo 站为例，第一次打开需要网络连接。

- 先去[Releases](https://github.com/yige233/echoes-of-terra/releases)下载“arknights-echoes-of-terra-resources.zip”，保存备用。
- 打开[demo 站](https://echoes-of-terra.doveyige.top/)，网页首先会缓存正常运行所必要的资源（<1MB）。
- 找到“下载资源”一节，并点击“上传本地资源压缩包”按钮，然后选择刚才第一步下载好的压缩包。
  - 由于 vercel 的限制，没法通过 demo 站提供这个大小约 244MB 的压缩包，所以需要手动从 GitHub 下载。
- 等待资源缓存完成，找到“前往活动页面”一节，点击“前往活动页面”按钮，就可以打开原活动页面了。
- 进入活动页面后，点击登录，然后输入任意内容，即可完成登录。要回到控制页面，只需要退出登录即可。

## 自行搭建

- 这里只有静态文件。也就是说只要找个 http 服务器，然后把所有内容放到服务器下面的某个目录里就好了。
- 如果可以的话（例如本地搭建），可以把压缩包放在和 index.html 同级的目录下，这样就可以让“下载资源并缓存”按钮正常工作了。
